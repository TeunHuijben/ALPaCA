import numpy as np
import numpy.testing as npt

from alpaca.parameters import params_gold
from alpaca.PSF import PSFclass

def test_refractive_indices():
    params = params_gold()
    PSF = PSFclass(params)
    image = PSF.calc_PSF()['PSF']

    image_gt = np.array([
        [0.05073539, 0.02409943, 0.03871506, 0.08954584, 0.13216977, 0.13216977, 0.08954584, 0.03871506, 0.02409943, 0.05073539],
        [0.02409943, 0.05885001, 0.18740983, 0.33222996, 0.41491776, 0.41491776, 0.33222996, 0.18740983, 0.05885001, 0.02409943],
        [0.03871506, 0.18740983, 0.41491776, 0.55811319, 0.58567961, 0.58567961, 0.55811319, 0.41491776, 0.18740983, 0.03871506],
        [0.08954584, 0.33222996, 0.55811319, 0.54883156, 0.40773022, 0.40773022, 0.54883156, 0.55811319, 0.33222996, 0.08954584],
        [0.13216977, 0.41491776, 0.58567961, 0.40773022, 0.10787329, 0.10787329, 0.40773022, 0.58567961, 0.41491776, 0.13216977],
        [0.13216977, 0.41491776, 0.58567961, 0.40773022, 0.10787329, 0.10787329, 0.40773022, 0.58567961, 0.41491776, 0.13216977],
        [0.08954584, 0.33222996, 0.55811319, 0.54883156, 0.40773022, 0.40773022, 0.54883156, 0.55811319, 0.33222996, 0.08954584],
        [0.03871506, 0.18740983, 0.41491776, 0.55811319, 0.58567961, 0.58567961, 0.55811319, 0.41491776, 0.18740983, 0.03871506],
        [0.02409943, 0.05885001, 0.18740983, 0.33222996, 0.41491776, 0.41491776, 0.33222996, 0.18740983, 0.05885001, 0.02409943],
        [0.05073539, 0.02409943, 0.03871506, 0.08954584, 0.13216977, 0.13216977, 0.08954584, 0.03871506, 0.02409943, 0.05073539],
        ])
    
    npt.assert_allclose(image_gt, image, rtol=1e-3, atol=1e-5)
